##
## Roughly follows the Linux Kernel coding guidelines, interpreting them for C++
##
## https://www.kernel.org/doc/html/latest/process/coding-style.html
##

{
	"Language": "Cpp",
	"Standard": "c++17",

	# The LLVM style comes pretty close to what we want by default
	"BasedOnStyle": "LLVM",

	# Sync this with .editorconfig
	"UseTab": "AlignWithSpaces",
	"ColumnLimit": 100,

	# Assume that one TAB character is 8 spaces wide
	# This is required for calculating whether a line is wider than the limit defined above
	"TabWidth": 8,

	# Setup indentation using one TAB character
	# This needs to be synced with the value of TabWidth
	"IndentWidth": 8,
	"AccessModifierOffset": -8,
	"ContinuationIndentWidth": 8,
	"ConstructorInitializerIndentWidth": 8,

	# Put braces on the same line for every statement except for functions
	"BreakBeforeBraces": "WebKit",

	# Don't add unnecessary breaks, stay on the same line ...
	"AllowAllParametersOfDeclarationOnNextLine": false,
	"BreakStringLiterals": false,

	# ... except for functions and templates
	"AlwaysBreakTemplateDeclarations": true,
	"AllowShortFunctionsOnASingleLine": "None",

	# Don't allow empty lines at the start of a block
	"KeepEmptyLinesAtTheStartOfBlocks": false,

	# Don't add spaces to the beginning and end of aggregate initializers
	"SpacesInContainerLiterals": false,

	# Make goto labels stand out
	"IndentGotoLabels": false,

	# Don't waste space by aligning at the rightmost column
	"AlignEscapedNewlines": "Left",

	# Don't align variables
	"AlignConsecutiveAssignments": false,
	"AlignConsecutiveDeclarations": false,

	# Align macros and comments
	"AlignConsecutiveMacros": true,
	"AlignTrailingComments": true,

	# Automatically format comments, includes and using statements
	"IncludeBlocks": "Regroup",
	"ReflowComments": true,
	"SortIncludes": "CaseSensitive",
	"SortUsingDeclarations": true,

	# Disable packing to improve readability of very long signatures
	"BinPackParameters": false,
	"PackConstructorInitializers": "CurrentLine",

	"BreakConstructorInitializers": "BeforeComma",
	"BreakBeforeTernaryOperators": false,
	"SpaceBeforeCpp11BracedList": true,

	"IncludeCategories": [
		{
			# Includes relative to the file use #include "..."
			"Regex": "^\".+\"$",
			"Priority": 1,
		},
		{
			# All directories under src/
			"Regex": "^<(common|contacts|core|hid|ipts)/.+>$",
			"Priority": 2,
		},
		{
			# Dependencies
			"Regex": "^<(gsl|Eigen|spdlog|fmt|cairomm|CLI)/.+>$",
			"Priority": 3,
		},
		{
			# Dependencies with only a single header
			"Regex": "^<(INIReader.h|SDL.h)>$",
			"Priority": 3,
		},
		{
			# Linux userspace API
			"Regex": "^<(linux|sys)/.+>$",
			"Priority": 4,
		},

		# The C / C++ standard library is automatically assigned priority 5
	],
}
